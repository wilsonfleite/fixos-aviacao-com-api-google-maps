<!DOCTYPE html>
<html>
	<head>
		<title>Simple Map</title>
		<meta name="viewport" content="initial-scale=1.0">
		<meta charset="utf-8">
		<style>
		  #map {
			height: 100%;
		  }
		  html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		  }
		</style>
		<script type="text/javascript" src="fixes.json"></script>
	</head>
	
	<body>
		<!--<div><input value="Waypoints" type="button" onclick="showhide()"/></div>-->
		<div id="map"></div>
		<script>
		
		var image = 'ponto.png';
		var map, infoWindow;
		var markers = [];
		var showmarkers = true;
		
		function initMap() {
			map = new google.maps.Map(document.getElementById('map'), {
				center: {lat: -23.555700, lng: -46.633863},
				zoom: 12,
			});
			
			for (var i = 0; i < fixes.length; i++) {
				var data = fixes[i];
				if (data.lat < -22 && data.lat > -25 && data.lng < -45 && data.lng > -48){
				
					var goldStar = {
						//path: 'M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z',
						path: 'M 0,20 10,20 5,10 z',
						fillColor: 'yellow',
						fillOpacity: 0.0,
						scale: 1,
						strokeColor: 'blue',
						strokeWeight: 3,
						rotation: 0
					};
				
					var marker = new google.maps.Marker({
						position: {lat: data.lat, lng: data.lng},
						map: map,
						//icon: image,
						icon: goldStar,
						/*icon: {
							path: google.maps.SymbolPath.CIRCLE,
							scale: 10
						},*/
						label: data.title,
						title: data.description
					});
					
					infoWindow = new google.maps.InfoWindow;

					// Try HTML5 geolocation.
					if (navigator.geolocation) {
					  navigator.geolocation.getCurrentPosition(function(position) {
						var pos = {
						  lat: position.coords.latitude,
						  lng: position.coords.longitude
						};

						infoWindow.setPosition(pos);
						infoWindow.setContent('Location found.');
						infoWindow.open(map);
						map.setCenter(pos);
					  }, function() {
						handleLocationError(true, infoWindow, map.getCenter());
					  });
					} else {
					  // Browser doesn't support Geolocation
					  handleLocationError(false, infoWindow, map.getCenter());
					}
					
				}
				/*markers.push(marker);*/
			}
			
			/*google.maps.event.addListener(map, 'zoom_changed', function () {

				var currentZoom = map.getZoom();

				if (currentZoom >= 8) {
					for (var j = 0; j < markers.length; j++) {
						markers[j].setMap(map);
					}
				} else if (currentZoom < 8) {
					for (var j = 0; j < markers.length; j++) {
						markers[j].setMap(null);
					}
				}
			});*/
			
		}
		
		/*function showhide(){
			if (showmarkers == true){
				for (var j = 0; j < markers.length; j++) {
					markers[j].setMap(null);
				}
				showmarkers = false;
			}else{
				for (var j = 0; j < markers.length; j++) {
					markers[j].setMap(map);
				}
				showmarkers = true;
			}
		}*/
		
		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
			infoWindow.setPosition(pos);
			infoWindow.setContent(browserHasGeolocation ?
				'Error: The Geolocation service failed.' :
				'Error: Your browser doesn\'t support geolocation.');
			infoWindow.open(map);
		}
		
		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCr5g6R40R7dXXW4vzvDSXhpQxVmbQ6g-4&callback=initMap" async defer></script>
  </body>
</html>